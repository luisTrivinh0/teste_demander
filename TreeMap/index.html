<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treemap Example</title>
    <style>
        /* Estilo básico para o SVG */
        svg {
            border: 1px solid #ddd;
            margin: 20px;
        }

        /* Estilo para os retângulos */
        rect {
            stroke: #000;
            stroke-width: 1px;
        }

        /* Estilo para o texto */
        text {
            font-size: 14px;
            fill: #000;
        }
    </style>
</head>

<body>
    <!-- Container SVG para o Treemap -->
    <svg id="treemap" width="600" height="400"></svg>

    <script>
        /**
         * Função que cria o layout de um Treemap usando o algoritmo Squarify.
         * @param {number[]} data - Dados a serem exibidos no Treemap.
         * @param {number} width - Largura total do Treemap.
         * @param {number} height - Altura total do Treemap.
         * @returns {Object[]} - Array de objetos representando os retângulos do Treemap.
         */
        function squarify(data, width, height) {
            const total = data.reduce((sum, value) => sum + value, 0);
            const rects = [];

            /**
             * Função para calcular o layout de uma linha de retângulos.
             * @param {number[]} row - Dados da linha atual.
             * @param {number} width - Largura disponível para a linha.
             * @param {number} height - Altura da linha.
             * @param {number} offsetY - Deslocamento vertical da linha.
             */
            function layoutRow(row, width, height, offsetY) {
                const totalValue = row.reduce((sum, value) => sum + value, 0);
                let x = 0;
                const rowHeight = height / (data.length > 1 ? 2 : 1);

                for (const value of row) {
                    const rectWidth = (value / totalValue) * width;
                    rects.push({ x, y: offsetY, width: rectWidth, height: rowHeight });
                    x += rectWidth;
                }
            }

            /**
             * Função recursiva para organizar os retângulos em linhas.
             * @param {number[]} children - Dados restantes a serem organizados.
             * @param {number} width - Largura disponível.
             * @param {number} height - Altura disponível.
             * @param {number} offsetY - Deslocamento vertical atual.
             */
            function recursiveLayout(children, width, height, offsetY) {
                if (children.length === 1) {
                    layoutRow(children, width, height, offsetY);
                    return;
                }

                const row = [];
                let remainingWidth = width;
                let currentHeight = height;

                for (const value of children) {
                    row.push(value);
                    const rowTotal = row.reduce((sum, v) => sum + v, 0);
                    const rowWidth = (rowTotal / total) * width;

                    if (rowWidth > remainingWidth || children.indexOf(value) === children.length - 1) {
                        layoutRow(row, remainingWidth, currentHeight, offsetY);
                        remainingWidth = width;
                        row.length = 0;
                        offsetY += currentHeight / 2;
                    }
                }
            }

            recursiveLayout(data, width, height, 0);
            return rects;
        }

        /**
         * Função para desenhar o Treemap no SVG.
         */
        function drawTreemap() {
            const data = [30, 20, 40, 10];
            const labels = ['Softwares', 'Sistema Operacional', 'Fotos', 'Emails'];
            const width = 600;
            const height = 400;
            const svg = document.getElementById('treemap');
            const rects = squarify(data, width, height);

            rects.forEach((rect, index) => {
                // Criar o retângulo SVG
                const rectElement = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rectElement.setAttribute('x', rect.x);
                rectElement.setAttribute('y', rect.y);
                rectElement.setAttribute('width', rect.width);
                rectElement.setAttribute('height', rect.height);
                rectElement.setAttribute('fill', `hsl(${index * 90}, 70%, 70%)`);
                svg.appendChild(rectElement);

                // Criar o texto SVG para rótulo
                const textElement = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textElement.setAttribute('x', rect.x + rect.width / 2);
                textElement.setAttribute('y', rect.y + rect.height / 2);
                textElement.setAttribute('dy', '.3em');
                textElement.setAttribute('text-anchor', 'middle');
                textElement.textContent = labels[index];
                svg.appendChild(textElement);
            });
        }

        drawTreemap();
    </script>
</body>

</html>
